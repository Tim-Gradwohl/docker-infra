services:
  portainer:
    image: portainer/portainer-ce:latest
    container_name: portainer
    restart: unless-stopped

    # Portainer needs access to the Docker API
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - portainer_data:/data

    networks:
      - proxy

    labels:
      - traefik.enable=true
      - traefik.docker.network=proxy

      # Router
      - traefik.http.routers.portainer.rule=Host(`portainer.lan.timscloud.net`)
      - traefik.http.routers.portainer.entrypoints=web

      # Service -> container port 9000 (HTTP UI)
      - traefik.http.routers.portainer.service=portainer
      - traefik.http.services.portainer.loadbalancer.server.port=9000

      # Recommended hardening since WAN :80 is forwarded:
      # 1) LAN-only allowlist middleware (create it in your file provider, see below)
      # 2) Basic auth middleware (optional if you trust Portainer auth only)
      #
      # Uncomment once middlewares exist:
      # - traefik.http.routers.portainer.middlewares=lan-allowlist@file,auth-basic@file

volumes:
  portainer_data:

networks:
  proxy:
    external: true

